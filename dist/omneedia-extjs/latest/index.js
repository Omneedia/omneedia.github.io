var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='/cdn/dist/omneedia-extjs/latest/resources.css';document.getElementsByTagName('head')[0].appendChild(link);App.__NOTIFY__=document.createElement("div"),App.__NOTIFY__.hide=!0,App.prefs={items:[],onShow:function(){},width:370,height:500},document.getElementsByTagName("body")[0].appendChild(App.__NOTIFY__),Ext.define("omneedia.webapp.GlobalMenu",{extend:"Ext.Panel",xtype:"Menu",border:!1,constructor:function(e){this.callParent(arguments),this.initConfig(e);var t=[];t[0]={iconCls:"qxIcon",text:"<b>"+window.document.title+"</b>",menu:{items:[{text:"A propos de...",handler:function(){Ext.create("Ext.Window",{title:"A propos de...",width:500,modal:!0,closable:!0,resizable:!1,height:331,layout:"vbox",bodyStyle:"background-color:white",border:!1,buttonAlign:"center",listeners:{show:function(){}},bbar:[{text:"Credits",hidden:!0,handler:function(){Ext.create("Ext.Window",{title:"Credits",width:400,height:500,modal:!0,closable:!0,resizable:!1,layout:"vbox",bodyStyle:"background-color:white",border:!1,bbar:["->",{text:"Fermer",handler:function(e){e.up().up().close()}}],items:[]}).show().center()}},{text:"Licence",hidden:!0,handler:function(){Ext.create("Ext.Window",{title:"License",width:640,height:550,modal:!0,closable:!0,resizable:!0,layout:"vbox",bodyStyle:"background-color:white",border:!1,bbar:["->",{text:"Fermer",handler:function(e){e.up().up().close()}}],items:[]}).show().center()}},"->",{text:"Fermer",handler:function(e){e.up().up().close()}}],items:[{height:10,border:!1},{layout:"hbox",border:!1,items:[{xtype:"panel",border:!1,baseCls:"qxAboutLogo",width:150,height:150},{xtype:"panel",flex:1,height:150,width:500,border:!1,html:"<div class=AboutBoxTitle>"+window.document.title+"<div class=AboutBoxDescription>"+Settings.DESCRIPTION+"</div><div class=AboutBoxVersion>version "+Settings.VERSION+"."+Settings.BUILD+"</div><div class=AboutBoxCopyright>"+Settings.COPYRIGHT+"</div>"}]},{layout:"hbox",width:"100%",border:!1,items:[{border:!1,html:'<div class=AboutBoxLicence>EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS PROVIDE THE SOFTWARE "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE SOFTWARE IS WITH YOU. SHOULD THE SOFTWARE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE SOFTWARE (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE SOFTWARE TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</div>',flex:1}]}]}).show().center()}},{iconCls:"mnu_preferences",text:"Mes préférences",handler:function(){return App.prefs.onShow()}}]}};for(var o=0;o<this.menu.length;o++)t[o+1]=this.menu[o];t[o+1]="->",t[o+2]={id:"GlobalMenuUser",menu:{items:[{text:"Déconnexion",handler:function(){Auth.logout()}}]}},t[o+3]={id:"GlobalMenuDateTime"},t[o+4]={id:"GlobalMenuLang",menu:{items:[]}},t[o+5]={iconCls:"QxNotificationBar",handler:function(){App.__NOTIFY__.center=document.createElement("iframe"),App.__NOTIFY__.center.style.width="100%",App.__NOTIFY__.center.style.height="100%",App.__NOTIFY__.center.style.position="absolute",App.__NOTIFY__.center.style.left="0px",App.__NOTIFY__.center.style.top="0px",App.__NOTIFY__.center.style.border="0px solid black",App.__NOTIFY__.center.src="/notification-center",App.__NOTIFY__.center.id=App.uuid(),App.__NOTIFY__.appendChild(App.__NOTIFY__.center),App.__NOTIFY__.center.onload=function(){var e=App.__NOTIFY__.center.contentWindow.document,t=new Date;e.querySelector(".date").innerHTML=t.toString("dddd")+"<br>"+t.toString("dd")+" "+t.toString("MMMM")},App.__NOTIFY__.hide?(App.__NOTIFY__.hide=!1,App.__NOTIFY__.classList.add("OASlidingPanel"),App.__NOTIFY__.classList.add("animated"),App.__NOTIFY__.classList.remove("slideOutRight"),App.__NOTIFY__.classList.add("slideInRight")):(App.__NOTIFY__.hide=!0,App.__NOTIFY__.classList.remove("slideInRight"),App.__NOTIFY__.classList.add("slideOutRight"))}};var n=new Ext.Toolbar({items:t});if(this.addDocked(n),window.setInterval(function(){Ext.getCmp("GlobalMenuDateTime").setText(moment().format("llll"))},1e3),Ext.getCmp("GlobalMenuUser").hide(),"mobile"!=Settings.TYPE){Auth.user(function(e){e&&(e.mail?(Ext.getCmp("GlobalMenuUser").setText(e.mail.split("@")[0]),Ext.getCmp("GlobalMenuUser").show()):(Ext.getCmp("GlobalMenuUser").setText("..."),Ext.getCmp("GlobalMenuUser").show()))});for(o=0;o<Settings.LANGS.length;o++){if(0==o)var i=Settings.LANGS[o].toUpperCase();Ext.getCmp("GlobalMenuLang").menu.add({text:Settings.LANGS[o].toUpperCase(),handler:function(e){moment.locale(e.text.toLowerCase()),window.localStorage.LANG=e.text.toLowerCase(),document.body.lang=window.localStorage.LANG,Ext.getCmp("GlobalMenuLang").setText(document.body.lang.toUpperCase())}}),window.localStorage.LANG?(Ext.getCmp("GlobalMenuLang").setText(window.localStorage.LANG.toUpperCase()),moment.locale(window.localStorage.LANG.toUpperCase())):(Ext.getCmp("GlobalMenuLang").setText(i.toUpperCase()),window.localStorage.LANG=i.toLowerCase(),moment.locale(window.localStorage.LANG.toLowerCase()))}}}});function getAllChildren(e){var t=e.items?e.items.items:[];return Ext.each(t,function(e){t=t.concat(getAllChildren(e))}),t}function getAllChildrenIds(e){for(var t=getAllChildren(e),r=0,n=t.length;r<n;r++)t[r]=t[r].getId();return t}Ext.define("Ext.overrides.layout.container.Container",{override:"Ext.layout.container.Container",notifyOwner:function(){this.owner.afterLayout(this)}}),Ext.define("Ext.overrides.layout.container.Container",{override:"Ext.layout.container.Container",notifyOwner:function(){this.owner.afterLayout(this)}}),App.apply(App,{remote:"",APP:{},libs:[],namespace:Settings.NAMESPACE,getArray:function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(e[n][t]);return r}}),App.define("App.info",{statics:{loading:function(e){e||(e="");var t=document.createElement("div");document.body.appendChild(t);var r=new Spinner({lines:13,length:11,width:5,radius:17,corners:1,rotate:0,color:"#FFF",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"}).spin(t);App._loading=_Overlay({text:e,spinner:r})},success:function(e){e||(e=""),App._loading=_Overlay({icon:"overlay_check",text:e})},error:function(e){e||(e=""),App._loading=_Overlay({icon:"overlay_error",text:e})},hide:function(){App._loading&&App._loading.hide()}}}),App.apply(App,{stores:function(e){var t=0;function r(e,r){t==e&&r(),t++}var n=[];if(e instanceof Ext.Component){for(var o=function e(t){var r=t.items?t.items.items:[];return Ext.each(r,function(t){r=r.concat(e(t))}),r}(e),i=0;i<o.length;i++)o[i].store&&n.push(o[i].getStore());return{get:function(){return n},on:function(e,t){for(var o=0;o<n.length;o++)n[o].on(e,function(e){r(n.length-1,t)})}}}return!1}}),App.apply(App,{get:function(e,t){return t?"object"!=typeof e?null:e.query(t).length>0?e.query(t)[0]:void 0:Ext.ComponentQuery.query(e).length>0?Ext.ComponentQuery.query(e)[0]:null},getData:function(e){var t={};if(e instanceof Ext.Component){for(var r=function e(t){var r=t.items?t.items.items:[];return Ext.each(r,function(t){r=r.concat(e(t))}),r}(e),n=0;n<r.length;n++)r[n].bindTo?r[n].getValue&&(t[r[n].bindTo]=r[n].getValue()):r[n].getValue&&r[n].itemId&&(t[r[n].xtype+"#"+r[n].itemId]=r[n].getValue());return t}return{result:{message:"MISMATCHED_TYPE",success:!1}}},getAll:function(e,t){return t?"object"==typeof e?e.query(t):void 0:Ext.ComponentQuery.query(e)},using:function(e){this.namespace=Settings.NAMESPACE;var t=Settings.REMOTE_API+"/api/"+e+"?javascript";Settings.DEBUG&&App.libs.push(t)},STOREMODELS:{tree:{name:"treestore",model:"Ext.data.TreeModel",store:"Ext.data.TreeStore"},events:{name:"eventstore",model:"Ext.ux.Scheduler.model.Event",store:"Ext.ux.Scheduler.data.EventStore"},resources:{name:"resourcestore",model:"Ext.ux.Scheduler.model.Resource",store:"Ext.ux.Scheduler.data.ResourceStore"},resourcestree:{name:"resourcestore",model:"Ext.ux.Scheduler.model.Resource",store:"Ext.ux.Scheduler.data.ResourceTreeStore"}},items:function(){return this.FORMS.items.items},FORMS:{},show:function(e){this.FORMS.layout.setActiveItem(e)},override:function(e,t){return Ext.define(Settings.NAMESPACE+".overrides."+e,t)}}),App.define("App.model",{statics:{get:function(name){return eval("var _p="+Settings.NAMESPACE+".model."+name),_p},create:function(e){return Ext.define("MODEL_"+App.uuid(),e)},define:function(e,t,r){if(t.extend=r||"Ext.data.Model",t.api){if(t.api instanceof Object){var n={};t.api.create&&(n.create=t.api.create),t.api.read&&(n.read=t.api.read),t.api.update&&(n.update=t.api.update),t.api.destroy&&(n.destroy=t.api.destroy);var o=!1;Auth.User&&(o=Auth.User.pudid);var i={type:"direct",extraParams:{pudid:o},api:n}}else i={type:"direct",extraParams:{pudid:o},directFn:t.api};i&&(t.proxy=i),t.api=null}if(t.db&&t.db.schema&&(Settings.REMOTE_API&&(my_url=Settings.REMOTE_API+"/db/"+t.db.schema+":model"),t.proxy={type:"rest",extraParams:{fields:Ext.encode(t.db.fields),where:Ext.encode(t.db.where)},url:my_url},t.db=null),t.requires)for(var a=0;a<t.requires.length;a++)t.requires[a]=Settings.NAMESPACE+".model."+t.requires[a];return Ext.define(Settings.NAMESPACE+".model."+e,t)}}}),App.define("App.view",{statics:{define:function(e,t){if(t.requires)for(var r=0;r<t.requires.length;r++)t.requires[r]=Settings.NAMESPACE+".view."+t.requires[r];return Ext.define(Settings.NAMESPACE+".view."+e,t)},create:function(e,t){return t?Ext.create(Settings.NAMESPACE+".view."+e,t):Ext.create(Settings.NAMESPACE+".view."+e)},show:function(e,t){alert("not yet implemented")},hide:function(e,t){alert("not yet implemented")},back:function(e,t){alert("not yet implemented")}}}),App.define("App.store",{statics:{createColumns:function(e,t){var r=e.getStore();r.on("load",function(n){for(var o=n.model.getFields(),i=[],a=0;a<o.length;a++)i.push({text:o[a].name,width:150,dataIndex:o[a].name});e.reconfigure(r,i),t()})},createEditorColumns:function(e){var t=e.getStore();t.on("load",function(r){for(var n=r.model.getFields(),o=[],i=0;i<n.length;i++){console.log(n[i].type.type);var a={text:n[i].name,width:150,dataIndex:n[i].name,editor:{allowBlank:!0},field:d},d={};"int"==n[i].type.type&&(a.editor={xtype:"numberfield",allowBlank:!0},a.xtype="numbercolumn",a.format="0"),"date"==n[i].type.type&&(delete a.editor,a.xtype="datecolumn",a.field={xtype:"datefield",allowBlank:!0,format:"m/d/Y"}),o.push(a)}e.reconfigure(t,o)})},define:function(e,t){if(t.extend="Ext.data.Store",t.model&&(t.requires||(t.requires=[]),t.requires[0]=t.model,t.model=Settings.NAMESPACE+".model."+t.model),t.requires)for(var r=0;r<t.requires.length;r++)t.requires[r]=Settings.NAMESPACE+".model."+t.requires[r],t.model=t.requires[r];return Ext.define(Settings.NAMESPACE+".store."+e,t)},get:function(name){return eval("var _p="+Settings.NAMESPACE+".store."+name),_p},create:function(e,t){var r=("M"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4);if(e instanceof Object==1){if((t=e).type)var n=App.STOREMODELS[t.type];else n={name:"store",model:"Ext.data.Model",store:"Ext.data.Store"};App.model.define(r,{},n.model),t.model=Settings.NAMESPACE+".model."+r,t.require=[],t.require.push(Settings.NAMESPACE+".model."+r)}else{if(t)if(t.type)n=App.STOREMODELS[t.type];else n={name:"store",model:"Ext.data.Model",store:"Ext.data.Store"};else n={name:"store",model:"Ext.data.Model",store:"Ext.data.Store"},t={};e.indexOf("://")>-1?(App.model.define(r,{api:{read:"App.__QUERY__.exec"},extraParams:{__SQL__:e}},n.model),"string"==typeof t&&(t={}),t.model=Settings.NAMESPACE+".model."+r,t.require=[],t.require[0]=Settings.NAMESPACE+".model."+r):e.indexOf(".")>-1?(App.model.define(r,{api:{read:e}},n.model),t.model=Settings.NAMESPACE+".model."+r,t.require=[],t.require.push(Settings.NAMESPACE+".model."+r)):("string"==typeof t&&(t={}),t.model=Settings.NAMESPACE+".model."+e,t.require=[],t.require[0]=Settings.NAMESPACE+".model."+e)}try{var o=Ext.create(n.store,t);o.getProxy().extraParams||(o.getProxy().extraParams={}),e.indexOf&&e.indexOf("://")>-1?o.getProxy().extraParams.__SQL__="!"+cipher.encrypt(window.z,e):o.getProxy().extraParams.__SQL__=e}catch(e){console.log(e)}return o}}}),App.define("App.controller",{statics:{define:function(e,t){if(t.extend="Ext.app.Controller",t.requires)for(var r=0;r<t.requires.length;r++)t.requires[r]=Settings.NAMESPACE+".controller."+t.requires[r];return Ext.define(Settings.NAMESPACE+".controller."+e,t)},create:function(e){return Ext.create(Settings.NAMESPACE+".controller."+e)}}}),Ext.Ajax.setDefaultHeaders={"accept-encoding":!0,z:window.z},Ext.override(Ext.data.proxy.Ajax,{headers:{"accept-encoding":!0,z:window.z}}),GURU_MEDITATION_FATAL=!1,Ext.util.Observable.observe(Ext.data.Connection,{requestexception:function(e,t,r){console.log(e),console.log(t),console.log(r)}});App.apply(App,{init:function(t,e){App.__INIT__=t,App.key.get("app.udid")||App.key.set("app.udid",Base64.encode(App.uuid()+"|"+navigator.userAgent)),App.udid=App.key.get("app.udid"),User={},App._kickstart(t,e)},init_langs:function(){for(var t=0;t<Settings.LANGS.length;t++)if(0==t)var e=Settings.LANGS[t].toUpperCase();window.localStorage.LANG||(window.localStorage.LANG=e),document.body.lang=window.localStorage.LANG},_kickstart:function(t,e){var i=this;window.Kickstart&&Kickstart.load&&Kickstart.load(),"mobile"!=Settings.TYPE&&(i.FORMS=Ext.create("Ext.container.Viewport",{id:"OAContainer",layout:"card",border:!1,items:[]})),Ext.require(Settings.NAMESPACE+".view."+t),Ext.onReady(function(){var n=Ext.create(Settings.NAMESPACE+".view."+t);n.on("render",function(t){window.Kickstart&&(Kickstart.ready&&Kickstart.ready(),i.init_langs()),e&&e(t)}),i.FORMS.add(n)})},load:function(t){App.request("/registry.json",function(t,e){try{Settings.registry=JSON.parse(e)}catch(t){Settings.registry={}}APP_NAMESPACE=Settings.NAMESPACE,LANGS=Settings.LANGS,Ext.Loader.setConfig({enabled:!0,paths:Settings.PATHS});var i=function(){Ext.application({name:APP_NAMESPACE,appFolder:"",autoCreateViewport:!1,controllers:Settings.CONTROLLERS,launch:function(){Ext.enableAriaButtons=!1,Ext.enableAriaPanels=!1}})};!function t(e){e||(e=0);if(Settings.ux)if(e<Settings.ux.length)App.require(Settings.ux[e],function(){t(e+1)});else{for(e=0;e<Settings.API.length;e++)App.using(Settings.API[e]);App.libs?App.require(App.libs,i):i()}else{for(var e=0;e<Settings.API.length;e++)App.using(Settings.API[e]);App.libs?App.require(App.libs,i):i()}}()})}});